<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chart.js Data Visualization</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body {
        background-color: #f8f9fa;
        font-family: Arial, sans-serif;
      }

      .container {
        margin-top: 50px;
      }

      .card {
        border-radius: 15px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .card-body {
        padding: 20px;
      }

      .chart-container {
        margin-bottom: 30px;
      }

      .chart-container canvas {
        border-radius: 10px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1 class="text-center my-4">Data Visualization Dashboard</h1>

      <!-- Row for bar and pie charts -->
      <div class="row">
        <div class="col-lg-6 col-md-12 mb-4">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Intensity Analysis</h5>
              <div class="chart-container">
                <canvas id="intensityChart"></canvas>
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-6 col-md-12 mb-4">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Likelihood Analysis</h5>
              <div class="chart-container">
                <canvas id="likelihoodChart"></canvas>
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-6 col-md-12 mb-4">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Relevance Analysis</h5>
              <div class="chart-container">
                <canvas id="relevanceChart"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- Pie chart for Region distribution -->
        <div class="col-lg-6 col-md-12 mb-4">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Region Distribution</h5>
              <div class="chart-container">
                <canvas id="regionChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Fetch data from the /data API
      fetch('/data')
        .then((response) => response.json())
        .then((data) => {
          // Process data for the charts
          const topics = data.map((item) => item.topic);
          const intensityValues = data.map((item) => item.intensity);
          const likelihoodValues = data.map((item) => item.likelihood);
          const relevanceValues = data.map((item) => item.relevance);
          const regions = data.map((item) => item.region);
          const regionCounts = regions.reduce((acc, region) => {
            acc[region] = (acc[region] || 0) + 1;
            return acc;
          }, {});

          // Create the intensity chart
          const intensityCtx = document
            .getElementById('intensityChart')
            .getContext('2d');
          new Chart(intensityCtx, {
            type: 'bar',
            data: {
              labels: topics,
              datasets: [
                {
                  label: 'Intensity',
                  data: intensityValues,
                  backgroundColor: 'rgba(255, 99, 132, 0.2)',
                  borderColor: 'rgba(255, 99, 132, 1)',
                  borderWidth: 1,
                },
              ],
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true,
                },
              },
            },
          });

          // Create the likelihood chart
          const likelihoodCtx = document
            .getElementById('likelihoodChart')
            .getContext('2d');
          new Chart(likelihoodCtx, {
            type: 'bar',
            data: {
              labels: topics,
              datasets: [
                {
                  label: 'Likelihood',
                  data: likelihoodValues,
                  backgroundColor: 'rgba(54, 162, 235, 0.2)',
                  borderColor: 'rgba(54, 162, 235, 1)',
                  borderWidth: 1,
                },
              ],
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true,
                },
              },
            },
          });

          // Create the relevance chart
          const relevanceCtx = document
            .getElementById('relevanceChart')
            .getContext('2d');
          new Chart(relevanceCtx, {
            type: 'bar',
            data: {
              labels: topics,
              datasets: [
                {
                  label: 'Relevance',
                  data: relevanceValues,
                  backgroundColor: 'rgba(75, 192, 192, 0.2)',
                  borderColor: 'rgba(75, 192, 192, 1)',
                  borderWidth: 1,
                },
              ],
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true,
                },
              },
            },
          });

          // Create the region distribution pie chart
          const regionCtx = document
            .getElementById('regionChart')
            .getContext('2d');
          new Chart(regionCtx, {
            type: 'pie',
            data: {
              labels: Object.keys(regionCounts),
              datasets: [
                {
                  label: 'Region Distribution',
                  data: Object.values(regionCounts),
                  backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)',
                  ],
                  borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)',
                  ],
                  borderWidth: 1,
                },
              ],
            },
            options: {
              responsive: true,
              plugins: {
                legend: {
                  position: 'top',
                },
                tooltip: {
                  callbacks: {
                    label: function (tooltipItem) {
                      return (
                        tooltipItem.label + ': ' + tooltipItem.raw + ' entries'
                      );
                    },
                  },
                },
              },
            },
          });
        })
        .catch((error) => console.error('Error fetching data:', error));
    </script>
  </body>
</html>
